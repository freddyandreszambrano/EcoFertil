{% extends 'components/base.html' %}

{% block content %}
<div class="card-transparent bg-white rounded mb-4">
  
  <button class="btn_go_back"  onclick="location.href='{% url 'OutfitGeneration:outfit_preseleccion' %}'">
    <svg height="16" width="16" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1024 1024"><path d="M874.690416 495.52477c0 11.2973-9.168824 20.466124-20.466124 20.466124l-604.773963 0 188.083679 188.083679c7.992021 7.992021 7.992021 20.947078 0 28.939099-4.001127 3.990894-9.240455 5.996574-14.46955 5.996574-5.239328 0-10.478655-1.995447-14.479783-5.996574l-223.00912-223.00912c-3.837398-3.837398-5.996574-9.046027-5.996574-14.46955 0-5.433756 2.159176-10.632151 5.996574-14.46955l223.019353-223.029586c7.992021-7.992021 20.957311-7.992021 28.949332 0 7.992021 8.002254 7.992021 20.957311 0 28.949332l-188.073446 188.073446 604.753497 0C865.521592 475.058646 874.690416 484.217237 874.690416 495.52477z"></path></svg>
    <span>VOLVER</span>
  </button>
  <div class="container d-flex justify-content-center">
    <button class="btn_generate_outfitIA">
      GENERAR OUTFIT
      <div class="star-1">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          version="1.1"
          style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
          viewBox="0 0 784.11 815.53"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <defs></defs>
          <g id="Layer_x0020_1">
            <metadata id="CorelCorpID_0Corel-Layer"></metadata>
            <path
              class="fil0"
              d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"
            ></path>
          </g>
        </svg>
      </div>
      <div class="star-2">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          version="1.1"
          style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
          viewBox="0 0 784.11 815.53"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <defs></defs>
          <g id="Layer_x0020_1">
            <metadata id="CorelCorpID_0Corel-Layer"></metadata>
            <path
              class="fil0"
              d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"
            ></path>
          </g>
        </svg>
      </div>
      <div class="star-3">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          version="1.1"
          style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
          viewBox="0 0 784.11 815.53"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <defs></defs>
          <g id="Layer_x0020_1">
            <metadata id="CorelCorpID_0Corel-Layer"></metadata>
            <path
              class="fil0"
              d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"
            ></path>
          </g>
        </svg>
      </div>
      <div class="star-4">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          version="1.1"
          style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
          viewBox="0 0 784.11 815.53"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <defs></defs>
          <g id="Layer_x0020_1">
            <metadata id="CorelCorpID_0Corel-Layer"></metadata>
            <path
              class="fil0"
              d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"
            ></path>
          </g>
        </svg>
      </div>
      <div class="star-5">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          version="1.1"
          style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
          viewBox="0 0 784.11 815.53"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <defs></defs>
          <g id="Layer_x0020_1">
            <metadata id="CorelCorpID_0Corel-Layer"></metadata>
            <path
              class="fil0"
              d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"
            ></path>
          </g>
        </svg>
      </div>
      <div class="star-6">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          version="1.1"
          style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"
          viewBox="0 0 784.11 815.53"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <defs></defs>
          <g id="Layer_x0020_1">
            <metadata id="CorelCorpID_0Corel-Layer"></metadata>
            <path
              class="fil0"
              d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"
            ></path>
          </g>
        </svg>
      </div>
    </button>
  </div>
</div>

<div class="card-transparent bg-white rounded mb-4">
  <div class="card-body">
    <h5 style="text-align: center;">Outfit Generado</h5>
    <div class="row">
      {% if ctx_clothes %}
        {% for outfit in ctx_clothes %}
        <div class="row mb-4">
          <div class="col-lg-4 col-md-6 mb-4">
            <h6>Prenda Superior</h6>
            <div class="img-thumbnail">
              <img src="{{ outfit.prenda_superior.garment }}" alt="Prenda Superior" class="img-fluid" data-clothes-id="{{ outfit.prenda_superior.id }}">
            </div>
          </div>
          <div class="col-lg-4 col-md-6 mb-4">
            <h6>Prenda Inferior</h6>
            <div class="img-thumbnail">
              <img src="{{ outfit.prenda_inferior.garment }}" alt="Prenda Inferior" class="img-fluid" data-clothes-id="{{ outfit.prenda_inferior.id }}">
            </div>
          </div>
          {% if outfit.zapato %}
            <div class="col-lg-4 col-md-6 mb-4">
              <h6>Zapato</h6>
              <div class="img-thumbnail">
                <img src="{{ outfit.zapato.garment }}" alt="Zapato" class="img-fluid" data-clothes-id="{{ outfit.zapato.id }}">
              </div>
            </div>
          {% endif %}
          <div class="col-lg-12 d-flex justify-content-center">
            <button id="guardar-outfit-btn-{{ outfit.id }}" type="button" class="btn btn-lg btn-outline-warning rounded-pill guardar-outfit-btn"
                    data-top-clothes-id="{{ outfit.prenda_superior.id }}"
                    data-bottom-clothes-id="{{ outfit.prenda_inferior.id }}"
                    data-shoe-clothes-id="{{ outfit.zapato.id }}">
                  <i class="bx bx-save fa-lg"></i> Guardar Outfit
            </button>
        </div>
        
        
        
      {% endfor %}
      {% else %}
        <p>No se pudo generar un outfit recomendado en este momento.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
// Captura el evento clic del botón
document.addEventListener("DOMContentLoaded", function() {
  // Selecciona todas las imágenes de las prendas
  var clothesImages = document.querySelectorAll('.img-thumbnail img');

  // Itera sobre cada imagen
  clothesImages.forEach(function(img) {
      // Agrega un evento de clic a cada imagen
      img.addEventListener('click', function() {
          // Obtiene el ID de la prenda del atributo de datos
          var clothesId = this.dataset.clothesId;
          
          // Envía el ID de la prenda al servidor
          enviarIdPrendaAlServidor(clothesId);
      });
  });
});

function enviarIdPrendaAlServidor(clothesId) {
  // Realiza una solicitud POST al servidor
  var xhr = new XMLHttpRequest();
  xhr.open('POST', "{% url 'OutfitGeneration:Outfit_saving' %}", true); // Reemplaza '/ruta/de/tu/vista/' con la URL de tu vista
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.onload = function() {
      if (xhr.status >= 200 && xhr.status < 300) {
          // Maneja la respuesta del servidor si es necesario
          console.log('ID de prenda enviado correctamente al servidor');
      } else {
          // Maneja errores si es necesario
          console.error('Error al enviar el ID de prenda al servidor');
      }
  };
  xhr.onerror = function() {
      // Maneja errores de red si es necesario
      console.error('Error de red al enviar el ID de prenda al servidor');
  };
  // Envía el ID de la prenda como parte del cuerpo de la solicitud
  xhr.send('clothes_id=' + encodeURIComponent(clothesId));
}



</script>
{% endblock %}
